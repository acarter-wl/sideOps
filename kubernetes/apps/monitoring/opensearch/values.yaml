clusterName: "opensearch-cluster"
nodeGroup: "master"

# For a homelab environment, a single replica is often sufficient
replicas: 1

# Set resources based on your available capacity - adjust as needed
resources:
  requests:
    cpu: "1"
    memory: "1Gi"
  limits:
    cpu: "2"
    memory: "2Gi"

# Configure persistence
persistence:
  enabled: true
  # Use your default storage class or specify one
  storageClass: "ceph-block"
  accessModes:
  - ReadWriteOnce
  size: 30Gi

# Set Java heap size - adjust based on your available memory
opensearchJavaOpts: "-Xmx1g -Xms1g"

# Important for single-node deployments
singleNode: true

# Security configuration - reference external secrets
securityConfig:
  enabled: true
  actionGroupsSecret: ""
  configSecret: ""
  internalUsersSecret: ""
  rolesSecret: ""
  rolesMappingSecret: ""
  tenantConfigSecret: ""
  adminCredentials:
    # Reference the existing external secret instead of creating one
    username: admin
    password: admin
    createSecret: false
    secret:
      name: "opensearch-cluster-master-credentials"

# Network settings
networkHost: "0.0.0.0"

# For homelab environments, we can disable some production features
extraEnvs:
- name: "DISABLE_INSTALL_DEMO_CONFIG"
  value: "true"
- name: "DISABLE_SECURITY_PLUGIN"
  value: "true"
- name: "bootstrap.memory_lock"
  value: "true"

# Settings that take precedence over opensearch.yml
config:
  opensearch.yml: |
    discovery.type: single-node

# Dashboard settings - set to false since we're deploying separate dashboards
dashboards:
  enabled: false

# Add basic anti-affinity to improve reliability
antiAffinity: "soft"

# Prometheus metrics support
prometheus:
  enabled: true
  serviceMonitor:
    enabled: true
    labels:
      release: kube-prometheus-stack

# Configure service
service:
  type: ClusterIP
  httpPort: 9200
  transportPort: 9300

# Fix the ingress configuration - proper format for the chart
ingress:
  enabled: false

# Add necessary environment variables for Kubernetes
extraInitContainers: []
extraContainers: []

# Security context settings
podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000

# Security context for container level
securityContext:
  capabilities:
    drop:
    - ALL
  runAsNonRoot: true
  runAsUser: 1000

# # Use the default probes from the chart
# readinessProbe: {}
# livenessProbe: {}

# Lifecycle hooks
lifecycle:
  preStop:
    exec:
      command:
      - bash
      - -c
      - >
        set -e sleep 5

# Mount the external secret as environment variables
extraVolumes:
- name: admin-credentials
  secret:
    secretName: opensearch-cluster-master-credentials

extraVolumeMounts:
- name: admin-credentials
  mountPath: /usr/share/opensearch/config/opensearch-security/admin-creds
  readOnly: true
