global:
  clusterDomain: cluster.local

deploymentMode: SimpleScalable

loki:
  auth_enabled: false
  structuredConfig:
    frontend:
      scheduler_address: ''
    frontend_worker:
      scheduler_address: ''
    query_scheduler:
      use_scheduler_ring: true
      scheduler_ring:
        kvstore:
          store: memberlist


  server:
    log_level: debug

  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  storage:
    type: s3
    bucketNames:
      chunks: ceph-chunks
      ruler: ceph-ruler
      admin: ceph-admin
    s3:
      bucket: ceph-chunks
      endpoint: https://rook-ceph-rgw-ceph-objectstore.rook-ceph.svc.cluster.local
      signature_version: v4
      s3forcepathstyle: true
      insecure: false
      http_config: {}

  limits_config:
    retention_period: 720h
    max_query_parallelism: 128
    max_query_length: 721h
    max_streams_per_user: 10000
    ingestion_rate_mb: 15
    ingestion_burst_size_mb: 30
    max_line_size: 5242880  # 5MB

  ingester:
    chunk_encoding: snappy

  querier:
    max_concurrent: 4

  compactor:
    working_directory: /var/loki/compactor
    compaction_interval: 10m
    retention_enabled: true
    retention_delete_delay: 2h
    delete_request_store: s3
    delete_request_cancel_period: 24h

  query_scheduler:
    max_outstanding_requests_per_tenant: 4096

  table_manager:
    poll_interval: 2m
    creation_grace_period: 10m
    cache_table_names: true

ingester:
  lifecycler:
    ring:
      replication_factor: 3

compactor:
  persistence:
    enabled: true
    mountPath: /var/loki/compactor
    accessModes:
      - ReadWriteOnce
    size: 20Gi
    storageClass: ceph-block

backend:
  replicas: 3
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: loki-s3-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: loki-s3-creds
          key: AWS_SECRET_ACCESS_KEY

read:
  replicas: 3
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: loki-s3-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: loki-s3-creds
          key: AWS_SECRET_ACCESS_KEY

write:
  replicas: 3
  extraEnv:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: loki-s3-creds
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: loki-s3-creds
          key: AWS_SECRET_ACCESS_KEY

gateway:
  auth:
    enabled: false
  service:
    type: LoadBalancer

lokiCanary:
  enabled: true

minio:
  enabled: false

tracing:
  enabled: true
