loki:
  auth_enabled: false
  useTestSchema: true
  persistence:
    enabled: true
    size: 50Gi
    storageClassName: rook-ceph
  extraEnvFrom:
    - configMapRef:
        name: loki-runtime
  config: |
    auth_enabled: false
    server:
      http_listen_port: 3100
    common:
      storage:
        s3:
          s3: s3://minio.storage:9000/loki
          s3forcepathstyle: true
      path_prefix: /var/loki
    
    # Ring configuration for ingester
    ingester:
      lifecycler:
        ring:
          kvstore:
            store: inmemory
          replication_factor: 1
    
    # Ring configuration for distributor
    distributor:
      ring:
        kvstore:
          store: inmemory

    # General memberlist configuration (can be minimal for inmemory store)
    memberlist:
      join_members: [] 

    schema_config:
      configs:
        - from: 2020-10-24 
          store: boltdb-shipper
          object_store: s3
          schema: v11
          index:
            prefix: loki_index_
            period: 24h
    storage_config:
      aws:
        s3: s3://minio.storage:9000/loki
        s3forcepathstyle: true
        bucketnames: loki
        region: us-east-1
        insecure: true
      boltdb_shipper:
        shared_store: s3
        active_index_directory: /var/loki/boltdb-shipper-active
        cache_location: /var/loki/boltdb-shipper-cache
        cache_ttl: 24h

  image:
    tag: 2.9.3
  extraVolumes:
    - name: storage
      persistentVolumeClaim:
        claimName: loki-storage
  extraVolumeMounts:
    - name: storage
      mountPath: /var/loki
  env:
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: iam-loki-s3
          key: AWS_ACCESS_KEY_ID
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: iam-loki-s3
          key: AWS_SECRET_ACCESS_KEY
