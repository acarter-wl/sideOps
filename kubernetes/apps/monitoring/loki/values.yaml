deploymentMode: SimpleScalable

loki:
  auth_enabled: false
  commonConfig:
    ring:
      kvstore:
        store: memberlist
  limits_config:
    retention_period: 720h
    max_query_parallelism: 128
    max_query_length: 721h
    max_streams_per_user: 10000
  ingester:
    chunk_encoding: snappy
    max_global_streams_per_user: 1000000
    max_global_streams_per_metric: 100000
  querier:
    query_ingesters_within: 3h
    max_concurrent: 10
  distributor: {}
  frontend: {}
  storage_config:
    aws: # Define aws configuration instead of s3 directly under storage_config
      s3:
        bucket: ceph-chunks
        region: us-east-1
    boltdb_shipper:
      active_index_directory: /data/loki/index
      cache_location: /data/loki/index_cache
      retention_days: 730
    index_queries_cache:
      max_age: 3h
      max_size_mb: 1024
    chunks:
      chunk_target_size: 1536000
      compactor:
        working_directory: /data/loki/compactor
    tsdb_shipper:
      active_index_directory: /data/loki/index
      cache_location: /data/loki/index_cache
      retention_days: 730
  storage: # Only configure the bucket names here, authentication is handled by the secret
    bucketNames:
      chunks: ceph-chunks
      ruler: ceph-ruler
      admin: ceph-admin
    # Remove all sensitive information from here.
  schemaConfig: # Add the schema configuration
    configs:
      - from: "2024-04-01" # Use an appropriate date
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

compactor:
  persistence:
    enabled: true
    mountPath: /var/loki/compactor
    accessModes:
      - ReadWriteOnce
    size: 20Gi
    storageClass: ceph-block

lokiCanary:
  enabled: true
backend:
  replicas: 2
read:
  replicas: 2
write:
  replicas: 3
minio:
  enabled: false
grafana:
  enabled: false
extraEnvFrom:
  - secretRef:
      name: loki-s3-creds

resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 2Gi

tolerations:
  - operator: Exists
# loki:
#   config: |
#     auth_enabled: false
#     distributor:
#       ring:
#         kvstore:
#           store: memberlist

#     schema_config:
#       configs:
#       - from: "2024-04-01"
#         store: tsdb
#         object_store: s3
#         schema: v13
#         index:
#           prefix: loki_index_
#           period: 24h

#     storage_config:
#       aws:
#         s3:
#           bucket: ceph-chunks
#           region: us-east-1
#           endpoint: http://rook-ceph-rgw-ceph-objectstore.monitoring.svc.cluster.local
#           access_key_id: ${AWS_ACCESS_KEY_ID}
#           secret_access_key: ${AWS_SECRET_ACCESS_KEY}
#           signature_version: v4
#           s3forcepathstyle: true
#           insecure: true

#     limits_config:
#       retention_period: 672h
#       max_query_parallelism: 128
#       allow_structured_metadata: true
#       volume_enabled: true

#   deploymentMode: SimpleScalable

# extraEnv:
#   - name: AWS_ACCESS_KEY_ID
#     valueFrom:
#       secretKeyRef:
#         name: loki-s3-creds
#         key: access_key
#   - name: AWS_SECRET_ACCESS_KEY
#     valueFrom:
#       secretKeyRef:
#         name: loki-s3-creds
#         key: secret_key

# backend:
#   replicas: 3
# read:
#   replicas: 3
# write:
#   replicas: 3

# minio:
#   enabled: false
