loki:
  commonConfig:
    replication_factor: 1
    ring:
      kvstore:
        store: inmemory # Required for single binary mode

  storage:
    type: 'filesystem'
    filesystem:
      chunks_directory: /data/loki/chunks
      rules_directory: /data/loki/rules

  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  compactor:
    working_directory: /data/loki/compactor
    shared_store: filesystem
    retention_enabled: true
    retention_delete_delay: 2h
    retention_delete_worker_count: 10

  limits_config:
    enforce_metric_name: false
    reject_old_samples: true
    reject_old_samples_max_age: 168h
    max_entries_limit_per_query: 5000
    retention_period: 720h # 30 days
    allow_structured_metadata: true
    volume_enabled: true

  ruler:
    enable_api: true
    storage:
      type: local
      local:
        directory: /data/loki/rules
    rule_path: /data/loki/tmp-rules

  auth_enabled: false

singleBinary:
  replicas: 1
  persistence:
    enabled: true
    storageClass: ceph-block
    size: 50Gi # Increased from 20Gi for production
    accessModes: ReadWriteOnce

  resources:
    requests:
      cpu: "1"
      memory: "4Gi" # Increased from 2Gi
    limits:
      cpu: "2"
      memory: "8Gi" # Increased from 4Gi

  extraArgs: -target=all # Explicitly set for single binary mode

  extraVolumes:
    - name: tmp
      emptyDir: {}

  extraVolumeMounts:
    - name: tmp
      mountPath: /tmp

gateway:
  enabled: true

monitoring: # [Previous monitoring config remains the same]

# Disabled components
minio:
  enabled: false

backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0
