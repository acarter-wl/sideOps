server:
  http_listen_port: 3100
  grpc_listen_port: 9095

common:
  instance_interface: 127.0.0.1
  # Change this to point to your S3 compatible storage setup
  storage_backend: s3
  path_prefix: /var/loki
  replication_factor: 1 # Adjust based on desired redundancy (usually 1 in simple deployments)
  ring:
    instance_addr: 127.0.0.1
    kvstore:
      store: memberlist

# Configuration for Index and Chunk storage in S3
storage_config:
  aws:
    s3:
      minio:
        s3: "http://nDHdq3UjrbAw0R6k:rjAu8hYf24ra3kzsEApzhsjfqUG00LPt@minio.storage.svc.cluster.local:9000/loki"
        s3forcepathstyle: true


schema_config:
  configs:
    - from: 2020-10-27 # Starting date for this schema version
      store: boltdb-shipper # Index store
      object_store: s3       # Chunk store
      schema: v11          # Schema version
      index:
        prefix: index_
        period: 24h

chunk_store_config:
  max_look_back_period: 0s

  # S3 storage configuration using named_stores pattern from the github issue
compactor:
  working_directory: /var/loki/compactor
  shared_store: s3 # compacted chunks go to S3

ingester:
  wal:
    enabled: true # Recommended for persistence
    dir: /var/loki/wal

limits_config:
  enforce_metric_name: false
  reject_old_samples: true
  reject_old_samples_max_age: 168h # 7 days example retention - ADJUST THIS!
  # Other limits like ingestion rate, query limits, etc. can be set here.



# Add service configuration for memberlist
service:
  memberlist:
    # Ensure memberlist service is created
    enabled: true

backend:
  replicas: 2
  persistence:
    enabled: true
    size: 20Gi
    storageClassName: ceph-block

read:
  replicas: 2
  persistence:
    enabled: true
    size: 20Gi
    storageClassName: ceph-block

write:
  replicas: 3
  persistence:
    enabled: true
    size: 50Gi
    storageClassName: ceph-block

scheduler:
  enabled: true
  replicas: 2
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 250m
      memory: 256Mi

# Disable built-in Minio
minio:
  enabled: false

gateway:
  enabled: true
  auth_enabled: false
  service:
    type: LoadBalancer

monitoring:
  dashboards:
    enabled: true
  rules:
    enabled: true
  alerts:
    enabled: true
  serviceMonitor:
    enabled: true
