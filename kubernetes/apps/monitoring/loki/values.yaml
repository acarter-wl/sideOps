loki:
  config: |
    auth_enabled: false
    distributor:
      ring:
        kvstore:
          store: memberlist

    schema_config:
      configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

    storage_config:
      aws:
        s3:
          bucket: ceph-chunks
          region: us-east-1
          endpoint: http://rook-ceph-rgw-ceph-objectstore.monitoring.svc.cluster.local
          access_key_id: ${AWS_ACCESS_KEY_ID}
          secret_access_key: ${AWS_SECRET_ACCESS_KEY}
          signature_version: v4
          s3forcepathstyle: true
          insecure: true

    limits_config:
      retention_period: 672h
      max_query_parallelism: 128
      allow_structured_metadata: true
      volume_enabled: true

  deploymentMode: SimpleScalable

extraEnv:
  - name: AWS_ACCESS_KEY_ID
    valueFrom:
      secretKeyRef:
        name: loki-s3-creds
        key: access_key
  - name: AWS_SECRET_ACCESS_KEY
    valueFrom:
      secretKeyRef:
        name: loki-s3-creds
        key: secret_key

backend:
  replicas: 3
read:
  replicas: 3
write:
  replicas: 3

minio:
  enabled: false
