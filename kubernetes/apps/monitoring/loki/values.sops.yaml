deploymentMode: SimpleScalable

# Mount S3 credentials from the secret
loki:
    extraEnv:
        - name: S3_ACCESS_KEY
          valueFrom:
            secretKeyRef:
              name: loki-s3-creds
              key: access_key
        - name: S3_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: loki-s3-creds
              key: secret_key
    auth_enabled: false
    common:
        # Force a specific tenant ID
        ring:
            kvstore:
                store: memberlist
                schemaConfig:
                    configs:
                        - from: "2024-04-01"
                          store: tsdb
                          object_store: s3
                          schema: v13
                          index:
                            prefix: loki_index_
                            period: 24h
                storage:
                    type: s3
                    bucketNames:
                        chunks: ceph-chunks
                        ruler: ceph-ruler
                        admin: ceph-admin
                    s3:
                        endpoint: ENC[AES256_GCM,data:z+6B7422BS5bBfbG59rpHwyQr1waNDLx9Qg4Kgz07fguRx/SnW/itpVz2S0CM1a74r0QdCrZEFAYIp6c61BcUv4=,iv:UtX2viGnv0GyoOISdz+k7G9iSi6vaHwtNeylnletGvg=,tag:YG7NJXgAYvCfrmI84wGdww==,type:str]
                        region: ENC[AES256_GCM,data:+wPsMc1wc26x,iv:UGFzqJLhe/9x9oxu8W4QPUoUm46yCdZNlrylKpnFbvw=,tag:u6CMXoN7uSko1Q+RQNpjrQ==,type:str]
                        access_key_id: ${S3_ACCESS_KEY}
                        secret_access_key: ${S3_SECRET_KEY}
                        signatureVersion: ENC[AES256_GCM,data:3xU=,iv:vZA6uom12ffAUaXbj7DJ7qy3WoVbUddXj+3pS1Hpx58=,tag:PE9C9ctSio3UyzHsN2eP1w==,type:str]
                        s3ForcePathStyle: ENC[AES256_GCM,data:Qq4tBQ==,iv:GrCKE2rZoEedmCKlp23RGrmiXVI81EqadvmdS1De4vI=,tag:jpvZ6rFkpxrzJWoYX13xGA==,type:bool]
                        insecure: ENC[AES256_GCM,data:rbU+GA==,iv:MEscYaSWg6rf2BVZ5Zbx2M9aRJ+x5FFpoojh9fNVd1s=,tag:2Xxfyz0xoY3eSiidw4fM0g==,type:bool]
                        http_config: {}
                limits_config:
                    # Add retention period
                    retention_period: 720h
                    # Consider other limits
                    max_query_parallelism: 128
                    max_query_length: 721h
                    max_streams_per_user: 10000
                ingester:
                    chunk_encoding: snappy
                querier:
                    max_concurrent: 4
                compactor:
                    working_directory: /var/loki/compactor
                    compaction_interval: 10m
                    retention_enabled: true
                    retention_delete_delay: 2h
                    delete_request_store: s3
                query_scheduler:
                    max_outstanding_requests_per_tenant: 4096
                table_manager:
                    poll_interval: 2m
                    creation_grace_period: 10m
                    cache_table_names: true
ingester:
    lifecycler:
        ring:
            replication_factor: 3
compactor:
    persistence:
        enabled: true
        mountPath: /var/loki/compactor
        accessModes:
            - ENC[AES256_GCM,data:XpQfYLk90ce58Jyerw==,iv:ct13R12IsWxDQ/etlMQ22DrJekMxKUEu4xXzzmdLve4=,tag:1HRZwEAdY20pEXhnxYiRLA==,type:str]
        size: 20Gi
        storageClass: ceph-block
lokiCanary:
    enabled: true
backend:
    replicas: 2
read:
    replicas: 2
write:
    replicas: 3
minio:
    enabled: false
gateway:
    auth:
        enabled: false
    service:
        type: LoadBalancer
tracing:
    enabled: true
sops:
    age:
        - recipient: age18ynkp4xzwas6la23fvs5zhxazvqf7p3qw4vv26a346e8340gegfqh9c87h
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBTTzhaSlVteUI5a2pYMnd4
            azJlaFdHWW8rN0FNcUR4eWt1dXZqZGgxNUdnCkkrMXlUYk42STdwaWlIWm1OYmFl
            S0x5NnlWNFVDTXhBZXJVOWdNQWhpTk0KLS0tIDdLRHppLzZBdzh1MnZRZC91MERo
            b1JEZS82M0ppb2pjS0Myb2FZaFpaN0UKh12EfzuRMD1liO9eR3zAP9a/eg7Xb6Or
            UVhPyFZYhBnucaRhShRdb8kNZ3K5ZdGYNTpVb63MAdS8XfoBJnLk2w==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2025-05-17T13:01:07Z"
    mac: ENC[AES256_GCM,data:P6OT2NMuviBae68KGJYb3ewyJ7DJe9BMw+qyDRgGhw3dlxQEaCbKk+c/3u5Br13cdFb/yvu293ZgmDa8ca7NNFrPOtXvsUlz0EmOaOeunlw/KwKAoEKJ8ZRAin/e0okpqmi0TkVdmvnYrfWY0QgE7X3gsLOTRSis7d9u/wVMGmE=,iv:BCyV8ShS0Ox32Dkapj1ESX0s3G6vzADUHlqbnzvvRYw=,tag:M5NGIrq57LSSdrVKB+cYyA==,type:str]
    encrypted_regex: ^(data|stringData|.*[Ss]ecret.*|.*[Kk]ey.*|.*[Pp]assword.*|.*[Tt]oken.*|.*access.*|s3.*)$
    mac_only_encrypted: true
    version: 3.10.2
