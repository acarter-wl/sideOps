apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-minio-hosts-patch
  namespace: monitoring
data:
  hosts-patch.sh: |
    #!/bin/sh
    set -e
    
    # Add the hostname resolution to /etc/hosts
    if ! grep -q "loki.minio.storage.svc.cluster.local" /etc/hosts; then
      echo "Adding loki.minio.storage.svc.cluster.local to /etc/hosts"
      echo "10.43.173.94 loki.minio.storage.svc.cluster.local minio.storage.svc.cluster.local" >> /etc/hosts
    fi
    
    # Keep the container running
    exec "$@"