apiVersion: v1
kind: ConfigMap
metadata:
  name: loki-custom-config
  namespace: monitoring
data:
  config.yaml: |
    auth_enabled: false
    server:
      http_listen_port: 3100
      grpc_listen_port: 9095
      http_server_read_timeout: 600s
      http_server_write_timeout: 600s

    memberlist:
      join_members:
      - loki-memberlist.monitoring.svc.cluster.local
      - loki-backend-headless.monitoring.svc.cluster.local

    common:
      path_prefix: /var/loki
      replication_factor: 3
      ring:
        kvstore:
          store: memberlist
      storage:
        s3:
          s3: null
          insecure: true
          s3forcepathstyle: true
          http_config:
            insecure_skip_verify: true
          endpoint: http://10.43.173.94:9000
          region: us-east-1
          bucketnames: loki

    schema_config:
      configs:
      - from: 2024-04-01
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

    analytics:
      reporting_enabled: false

    ruler:
      storage:
        type: s3
        s3:
          s3: null
          insecure: true
          s3forcepathstyle: true
          http_config:
            insecure_skip_verify: true
          endpoint: http://10.43.173.94:9000
          region: us-east-1
          bucketnames: loki