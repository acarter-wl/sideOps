deploymentMode: SimpleScalable

loki:
  auth_enabled: false

  pattern_ingester:
    enabled: false

  # This is required by the Helm chart
  commonConfig:
    path_prefix: /var/loki
    replication_factor: 1
    ring:
      kvstore:
        store: memberlist

  storage:
    bucketNames:
      chunks: ceph-chunks
      ruler: ceph-ruler
      admin: ceph-admin

  # Basic schema configuration for the Helm chart
  schemaConfig:
    configs:
      - from: "2024-04-01"
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

  # Custom embedded configuration
  config: |
    auth_enabled: false

    common:
      ring:
        kvstore:
          store: memberlist

    limits_config:
      retention_period: 720h
      max_query_parallelism: 128
      max_query_length: 721h

    ingester:
      chunk_encoding: snappy

    querier:
      query_ingesters_within: 3h
      max_concurrent: 10

    schema_config:
      configs:
        - from: "2024-04-01"
          store: tsdb
          object_store: s3
          schema: v13
          index:
            prefix: loki_index_
            period: 24h

    storage_config:
      aws:
        s3:
          bucket: ceph-chunks
          endpoint: http://rook-ceph-rgw-ceph-objectstore.monitoring.svc.cluster.local
          region: us-east-1
          access_key_id: ${S3_ACCESS_KEY}
          secret_access_key: ${S3_SECRET_KEY}
          insecure: true
          s3forcepathstyle: true

      boltdb_shipper:
        active_index_directory: /data/loki/index
        cache_location: /data/loki/index_cache
        shared_store: s3

      tsdb:
        dir: /data/loki/tsdb

    table_manager:
      retention_deletes_enabled: true
      retention_period: 720h

    compactor:
      working_directory: /data/loki/compactor
      shared_store: s3

compactor:
  persistence:
    enabled: true
    mountPath: /var/loki/compactor
    accessModes:
      - ReadWriteOnce
    size: 20Gi
    storageClass: ceph-block

backend:
  replicas: 2
read:
  replicas: 2
write:
  replicas: 3

minio:
  enabled: false

extraEnvFrom:
  - secretRef:
      name: loki-s3-creds

resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 2Gi

tolerations:
  - operator: Exists
