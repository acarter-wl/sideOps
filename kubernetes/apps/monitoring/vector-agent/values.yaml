deploymentMode: SimpleScalable

loki:
  auth_enabled: false
  commonConfig:
    ring:
      kvstore:
        store: memberlist

  ingester:
    chunk_encoding: snappy
    # Removed max_global_streams fields that caused errors

  querier:
    query_ingesters_within: 3h
    max_concurrent: 10
  distributor: {}
  frontend: {}
  storage_config:
    aws: # Define aws configuration instead of s3 directly under storage_config
      s3:
        bucket: ceph-chunks
        region: us-east-1
        access_key_id: ${S3_ACCESS_KEY}
        secret_access_key: ${S3_SECRET_KEY}
        insecure: true
        s3forcepathstyle: true
    boltdb_shipper:
      active_index_directory: /data/loki/index
      cache_location: /data/loki/index_cache
      retention_days: 730
    index_queries_cache:
      max_age: 3h
      max_size_mb: 1024
    chunks:
      chunk_target_size: 1536000
      compactor:
        working_directory: /data/loki/compactor
    tsdb_shipper:
      active_index_directory: /data/loki/index
      cache_location: /data/loki/index_cache
      retention_days: 730
  storage: # Only configure the bucket names here, authentication is handled by the secret
    bucketNames:
      chunks: ceph-chunks
      ruler: ceph-ruler
      admin: ceph-admin
  schemaConfig: # Add the schema configuration
    configs:
      - from: "2024-04-01" # Use an appropriate date
        store: tsdb
        object_store: s3
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

compactor:
  persistence:
    enabled: true
    mountPath: /var/loki/compactor
    accessModes:
      - ReadWriteOnce
    size: 20Gi
    storageClass: ceph-block

lokiCanary:
  enabled: true
backend:
  replicas: 2
read:
  replicas: 2
write:
  replicas: 3
minio:
  enabled: false
grafana:
  enabled: false
extraEnvFrom:
  - secretRef:
      name: loki-s3-creds


resources:
  requests:
    cpu: 100m
    memory: 512Mi
  limits:
    cpu: 500m
    memory: 2Gi

tolerations:
  - operator: Exist
