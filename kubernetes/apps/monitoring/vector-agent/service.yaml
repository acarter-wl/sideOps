apiVersion: v1
kind: Service
metadata:
  name: vector-udp
  namespace: monitoring  # Match your Vector namespace (you had "monitoring" here)
  labels:
    app.kubernetes.io/name: vector
    app.kubernetes.io/component: agent
    app.kubernetes.io/part-of: vector-logging
  annotations:
    # Optional: Add service annotations based on your cloud provider
    # For example, on AWS you might want to specify:
    # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"  # For Network Load Balancer
spec:
  type: LoadBalancer
  # Use externalTrafficPolicy: Local to preserve client source IPs and avoid extra hops
  externalTrafficPolicy: Local
  ports:
    - name: talos-kernel
      port: 6050
      targetPort: 6050
      protocol: UDP
    - name: talos-service
      port: 6051
      targetPort: 6051
      protocol: UDP
  selector:
    # Make sure these match the labels that your Vector agent pods have
    app.kubernetes.io/name: vector
    app.kubernetes.io/component: agent
    app.kubernetes.io/instance: vector-agent
