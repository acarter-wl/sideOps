---
# Minimal configuration that avoids any custom log pipelines
cluster:
  name: "kubernetes"

global:
  scrapeInterval: 30s
  maxCacheSize: 100000

# Define destinations where telemetry will be sent
destinations:
  - name: prometheus
    type: prometheus
    url: http://prometheus.monitoring.svc:9090/api/v1/write

  - name: loki
    type: loki
    url: http://loki.monitoring.svc:3100/loki/api/v1/push

# Enable cluster metrics collection
clusterMetrics:
  enabled: true
  destinations: [ "prometheus" ]

# DISABLE node logs collection since Talos is already sending logs directly to Loki
# via the machine configuration
nodeLogs:
  enabled: false

# Enable pod logs collection
podLogs:
  enabled: true
  destinations: [ "loki" ]

# Enable Prometheus operator objects integration
prometheusOperatorObjects:
  enabled: true
  destinations: [ "prometheus" ]

# IMPORTANT: Enable the alloy-metrics collector (required for clusterMetrics)
alloy-metrics:
  enabled: true

# Configure the alloy-logs DaemonSet for Talos
# Do NOT add any custom extraConfig to avoid configuration conflicts
alloy-logs:
  enabled: true

  # Mount locations specific to Talos Linux
  alloy:
    mounts:
      varlog: true
      dockercontainers: false # Talos uses containerd, not Docker

# Enable singleton for other features
alloy-singleton:
  enabled: false

# Self-reporting can be disabled if desired
selfReporting:
  enabled: false
