configuration:
  provider: aws
  backupStorageLocation:
    bucket: <YOUR_CEPH_BUCKET>
    name: rook-ceph-bucket
    default: true
    config:
      region: rook-ceph
      s3ForcePathStyle: true
      s3Url: http://rook-ceph-rgw-my-store.rook-ceph.svc:80
  volumeSnapshotLocation:
    name: csi-snapshots
    provider: aws
    config:
      region: rook-ceph
  resticRepository: /mnt/velero-nfs/restic-repo

initContainers:
  - name: velero-plugin-for-aws
    image: velero/velero-plugin-for-aws:v1.12.0
    imagePullPolicy: IfNotPresent
    volumeMounts:
      - mountPath: /target
        name: plugins
  - name: velero-plugin-for-csi
    image: velero/velero-plugin-for-csi:v0.6.0
    imagePullPolicy: IfNotPresent
    volumeMounts:
      - mountPath: /target
        name: plugins
  - name: nfs-mount
    image: busybox
    command: ["/bin/sh", "-c", "mkdir -p /mnt/velero-nfs && mount -t nfs 192.168.100.94:/mnt/zpool-a/root-ds/backups /mnt/velero-nfs"]
    securityContext:
      privileged: true
    volumeMounts:
      - mountPath: /mnt/velero-nfs
        name: velero-nfs


extraVolumes:
  - name: velero-nfs
    nfs:
      server: 192.168.100.94
      path: /mnt/zpool-a/root-ds/backups
extraVolumeMounts:
  - mountPath: /mnt/velero-nfs
    name: velero-nfs
configuration:
  resticRepository: /mnt/velero-nfs/restic-repo
deployNodeAgent: true

resources:
  requests:
    cpu: 125m
    memory: 128Mi
  limits:
    cpu: 1000m
    memory: 512Mi

metrics:
  enabled: true

backupsEnabled: true
snapshotsEnabled: true

features:
  - EnableCSI

extraObjects:
  # Rook-Ceph as primary backup location
  - apiVersion: velero.io/v1
    kind: BackupStorageLocation
    metadata:
      name: rook-ceph
      namespace: velero
    spec:
      provider: aws
      objectStorage:
        bucket: bucket0-0
      config:
        region: rook-ceph
        s3ForcePathStyle: true
        s3Url: http://s3ceph.wakkalabs.com
      accessMode: ReadWrite
      default: true

  # TrueNAS NFS as long-term archive (local plugin)
  - apiVersion: velero.io/v1
    kind: BackupStorageLocation
    metadata:
      name: nfs-restic
      namespace: velero
    spec:
      provider: velero.io/local
      objectStorage:
        bucket: velero-nfs
      config:
        path: /mnt/velero-nfs/velero-metadata
      accessMode: ReadWrite
      default: false
