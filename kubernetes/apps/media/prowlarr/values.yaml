# Prowlarr values for app-template
# ---------------------------------------------------
controllers:
  main:
    enabled: true
    type: deployment
    replicas: 1
    strategy: Recreate
    initContainers:
      init-config:
        # Changed from array format to object format
        enabled: true
        image:
          repository: busybox
          tag: "latest"
          pullPolicy: IfNotPresent
        command:
          - /bin/sh
          - -c
          - |
            chown -R 0:0 /config
    # Add pod topology spread constraints to prevent multi-attach errors
    # topologySpreadConstraints:
    #   - maxSkew: 1
    #     topologyKey: kubernetes.io/hostname
    #     whenUnsatisfiable: DoNotSchedule
    #     labelSelector:
    #       matchLabels:
    #         app.kubernetes.io/name: prowlarr
    containers:
      main:
        enabled: true
        image:
          repository: "ghcr.io/home-operations/prowlarr"
          tag: "1.35.1.5034"
          pullPolicy: IfNotPresent
        env:
          TZ: America/Chicago
          PUID: "0"
          PGID: "0"
        securityContext:
          runAsUser: 0
          runAsGroup: 0
        resources:
          limits:
            cpu: 1000m
            memory: 2Gi
          requests:
            cpu: 100m
            memory: 256Mi
        probes:
          liveness:
            enabled: true
            spec:
              httpGet:
                path: /
                port: http
              initialDelaySeconds: 30
              periodSeconds: 10
              timeoutSeconds: 1
              failureThreshold: 5
          readiness:
            enabled: true
            spec:
              httpGet:
                path: /
                port: http
              initialDelaySeconds: 15
              periodSeconds: 10
              timeoutSeconds: 1
              failureThreshold: 3
          startup:
            enabled: true
            spec:
              httpGet:
                path: /
                port: http
              initialDelaySeconds: 5
              periodSeconds: 10
              timeoutSeconds: 1
              failureThreshold: 30
service:
  main:
    controller: main
    ports:
      http:
        port: 9696
        targetPort: 9696
ingress:
  main:
    enabled: true
    className: internal
    annotations:
      cert-manager.io/cluster-issuer: letsencrypt-production
    hosts:
      - host: prowlarr.wakkalabs.com
        paths:
          - path: /
            pathType: Prefix
            service:
              name: prowlarr
              port: 9696
    tls:
      - secretName: prowlarr-tls
        hosts:
          - prowlarr.wakkalabs.com
securityContext:
  fsGroup: 0
persistence:
  config:
    enabled: true
    type: persistentVolumeClaim
    existingClaim: prowlarr-config
    globalMounts:
      - path: /config
  downloads:
    enabled: true
    type: persistentVolumeClaim
    existingClaim: downloads-ceph
    globalMounts:
      - path: /downloads
