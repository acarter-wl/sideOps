crds:
  install: true
global:
  domain: argo.wakkalabs.com
configs:
  params:
    server.insecure: true
  cm:
    dex.config: |
      connectors:
        - type: oidc
          id: authentik
          name: authentik
          config:
            issuer: https://auth.wakkalabs.com/application/o/argocd/
            clientID: GHFrNg3pZTxyoxvzuut0q0Kr2HSkBBqX0rqINETT
            clientSecret: $dex.authentik.clientSecret
            insecureEnableGroups: true
            scopes:
              - openid
              - profile
              - email
    exec.enabled: true
    accounts.readonly: apikey
    statusbadge.enabled: true
    kustomize.buildOptions: --enable-alpha-plugins --enable-exec
    helm.valuesFileSchemes: secrets+gpg-import, secrets+gpg-import-kubernetes, secrets+age-import, secrets+age-import-kubernetes, secrets, secrets+literal, https
    resource.exclusions: |
      - apiGroups:
          - cilium.io
        kinds:
          - CiliumIdentity
        clusters:
          - "*"
  secret:
    argocdServerAdminPassword: ENC[AES256_GCM,data:LnDE6WXmZf4JAlhP1PqFNX0CfD6sqDvMbiCUGaaX2nJDeR+X76b2rUMbulfIhiqKM1AkZipb11yBg80m,iv:YjAuR0wcttLNp4zbKDqXBtYPXLCm+SXz9Hy25DnPcSw=,tag:eUO3REcN+5utSlvjWmTtzg==,type:str]
    argocdServerAdminPasswordMtime: ENC[AES256_GCM,data:My52cb6KWzgDmnKwanrsdTOcqA==,iv:D4qg0+rYM+ABO4g97s6wh3qW/yXYi3E89vrlKU1cHVU=,tag:UTGSoS7ohV7FWZqbqPwuEA==,type:str]
    githubSecret: ENC[AES256_GCM,data:TuLFFAYjfN2HpRR7nHBE7eyP8/QszAJJVGd6xsZJLsE=,iv:KtK0Om0nwnZfo/IB8uCn4QoghEFUqZ/oYdldye+oG8s=,tag:OAEEFl/0lJbFJJfTmhhCNg==,type:str]
    dex.authentik.clientSecret: ENC[AES256_GCM,data:IpepSpNiAddCQZZ7mTzq42eLVocwLU43Fi3zs2Qy3ps2Ds3/Qe4Sp2WVVzD1uHjedtNrZeHCpvCNjcFmz/MjBjILe2iDspc1JsnZS6YHDNyipJNUbNk1kr+eyhMb2TEQj3Q0MNx8w1qiQDeoAADxCsjD9zJtBfuIZuUXksYB/zQ=,iv:Wj2kTia3OiICZsfiomENSfetKkY6+FmNad/mbfz/+iM=,tag:/AqL0xPYO6Me34dwtPzgcQ==,type:str]
controller:
  replicas: 2
  metrics:
    enabled: true
    applicationLabels:
      enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: kube-prometheus-stack
dex:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: kube-prometheus-stack
redis:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: kube-prometheus-stack
server:
  replicas: 2
  allowAnyNamespace: true
  ingress:
    enabled: true
    ingressClassName: external
    annotations:
      external-dns.alpha.kubernetes.io/target: external.wakkalabs.com
    hostname: argo.wakkalabs.com
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: kube-prometheus-stack
  containers:
    - args:
        - /usr/local/bin/argocd-server
        - --port=8080
        - -metrics-port=8083
notifications:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      additionalLabels:
        release: kube-prometheus-stack
repoServer:
  replicas: 2
  serviceAccount:
    create: true
    name: argocd-repo-server
  rbac:
    - apiGroups:
        - ""
      resources:
        - secrets
      verbs:
        - get
  env:
    - name: HELM_PLUGINS
      value: /custom-tools/helm-plugins/
    - name: HELM_SECRETS_CURL_PATH
      value: /custom-tools/curl
    - name: HELM_SECRETS_SOPS_PATH
      value: /custom-tools/sops
    - name: HELM_SECRETS_VALS_PATH
      value: /custom-tools/vals
    - name: HELM_SECRETS_KUBECTL_PATH
      value: /custom-tools/kubectl
    - name: HELM_SECRETS_BACKEND
      value: sops
    # https://github.com/jkroepke/helm-secrets/wiki/Security-in-shared-environments
    - name: HELM_SECRETS_VALUES_ALLOW_SYMLINKS
      value: "false"
    - name: HELM_SECRETS_VALUES_ALLOW_ABSOLUTE_PATH
      value: "true"
    - name: HELM_SECRETS_VALUES_ALLOW_PATH_TRAVERSAL
      value: "false"
    - name: HELM_SECRETS_WRAPPER_ENABLED
      value: "true"
    - name: HELM_SECRETS_DECRYPT_SECRETS_IN_TMP_DIR
      value: "true"
    - name: HELM_SECRETS_HELM_PATH
      value: /usr/local/bin/helm
    # For age
    - name: SOPS_AGE_KEY_FILE
      value: /helm-secrets-private-keys/key.txt
  volumes:
    - name: custom-tools
      emptyDir: {}
    # kubectl create secret generic helm-secrets-private-keys --from-file=key.asc=assets/gpg/private2.gpg
    - name: helm-secrets-private-keys
      secret:
        secretName: ENC[AES256_GCM,data:5elBZmxJHhRSHfv5fs3VVZ3nXtncqH2xyA==,iv:1WyUCwFjKhq6Cs5GNciKDUqYUMnEzwv/6Ljf8NTj/os=,tag:7SEL9Uf4YLGcyPmwd28x3w==,type:str]
  volumeMounts:
    - mountPath: /custom-tools
      name: custom-tools
    - mountPath: /usr/local/sbin/helm
      subPath: helm
      name: custom-tools
    - mountPath: /usr/local/bin/kustomize
      name: custom-tools
      subPath: kustomize
    - mountPath: /usr/local/bin/ksops
      name: custom-tools
      subPath: ksops
    - mountPath: /helm-secrets-private-keys/
      name: helm-secrets-private-keys
  initContainers:
    - name: gitops-tools
      image: ajaykumar4/gitops-tools:1.0.1
      imagePullPolicy: Always
      command:
        - sh
        - -ec
      args:
        - |
          mkdir -p /custom-tools/
          cp -rf /gitops-tools/* /custom-tools
          chmod +x /custom-tools/*
      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools
sops:
  age:
    - recipient: age18ynkp4xzwas6la23fvs5zhxazvqf7p3qw4vv26a346e8340gegfqh9c87h
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBCNG05Uk0vZXpNaXUrTG1q
        akdTMENvME1zRzJweFRoZkVTRVhiMmFxSmpjCkJ3OGVNdE1sQlQ3M0l6TWwyREZn
        STA4RXBzYm1IY1ovNkdNTjRIRktLRGsKLS0tIEFLNWVHVWtSUzhUTzYvQlZiTGh0
        aXJtWkxPbXRiUVZ1bklEcUhaVzk0V00KKsobDfwums3Nkv0M+770j3ek6OKW1/WL
        r3rQt+T556ppP4o0o2A9Foqd3qFYsPeCxE/9vMfoApKck4zNcqKvWA==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-26T08:44:00Z"
  mac: ENC[AES256_GCM,data:lcspyFooEupZCfBjDMc4d3j/XcY4DTSs7tzNkSv5nmhoYeRsjJLA6yc+9p8Bt/uuG2+k0x+MZHRY5ZFKEa1M1idakaaZh/wSQUmHy/F2wpvsNAvnoCl36p/Ed/W0xBFWVljcEBZcPjpACK3zLfh4cVafjwEEPnWQW4sT09AqOGc=,iv:X9zDZU5ccMxgCgjJqODj3s/pDqaS5pQguvXbPrv3fFY=,tag:owt/s91zRb40L+hHngdAqw==,type:str]
  encrypted_regex: ^(data|stringData|.*[Pp]assword|.*[Ss]ecret|.*[Tt]oken)$
  version: 3.10.2
