crds:
  install: true

global:
  domain: argo.wakkalabs.com
configs:
  params:
    server.insecure: true

  cm:
    dex.config: |
      connectors:
        - type: oidc
          id: authentik
          name: authentik
          config:
            issuer: https://auth.wakkalabs.com/application/o/argocd/
            clientID: GHFrNg3pZTxyoxvzuut0q0Kr2HSkBBqX0rqINETT
            clientSecret: $dex.authentik.clientSecret
            insecureEnableGroups: true
            scopes:
              - openid
              - profile
              - email
              - groups
            getUserInfo: true

    exec.enabled: true
    accounts.readonly: apikey
    statusbadge.enabled: true
    kustomize.buildOptions: --enable-alpha-plugins --enable-exec
    helm.valuesFileSchemes: >
      secrets+gpg-import, secrets+gpg-import-kubernetes, secrets+age-import, secrets+age-import-kubernetes, secrets, secrets+literal, https

    resource.exclusions:
      - apiGroups: [ "cilium.io" ]
        kinds: [ "CiliumIdentity" ]
        clusters: [ "*" ]

  rbac:
    policy.csv: |
      g, ArgoCD Admins, role:admin
      g, ArgoCD Users, role:readonly
    policy.default: role:readonly
    scopes: '[groups]'

  secret:
    argocdServerAdminPassword: ENC[AES256_GCM,data:8wZCSKeojMYrecSHw5ARwj5YHhmWUrqPs6eUTMUtxPQqd360gkfegp+xdDIGZ/OtwvStZxvA2GWb4dQ4fCfRqDUNrXOLWKX13EgpOm9WRl6/l+fyiHXpqEFFDyMtBu9CcUaYPcTc5KWDWujMKmBa7qeoFKOODRtYIx1RZuXO3aZ33SOCU3/9Ewjnp78HUK6vZlSvqbGR8nGi1N5YrROC3VW84wo248XmrLe0gFGnaxgzASacdn8afHoYYw==,iv:f7PUgDiurP1Mxmi0edoqgIDTSDv/IT6t7pEVqCnBpLw=,tag:FeVnlDEwltyf845WpagafA==,type:str]
    argocdServerAdminPasswordMtime: ENC[AES256_GCM,data:btzM12IhgCLLwZzJ9WjtXPwS2C/afSgIHDNSzJc/MgY5ceLAS/OOQTFQDWJcOr2Qpy31Ap32IgeujaptBx7k/MfHP0wKCrOP6qtFF4ar+KU925pjNbFJM0Y0apGnioZ14z/ymSp9vGoBtSUBHAKPyGHAGTTqR1KgherZkEnMBc91z0ouzocs,iv:5p7dV5DEOpSB0Ye4yTGBL1yHqxCxxUIs1bUAgHcLSRg=,tag:SR0sN3o/MQxLqtaAetG+Cg==,type:str]
    githubSecret: ENC[AES256_GCM,data:oeidWvlSrQJLRDcGx44l3eLe3L7nKS0Eg5D3sUpTWIcU3DslflH61r2Yh0jGy/Rycr8nW7V5dE1SfOrbaUGROcuT0Li3WTMcZumqpeKRt7pLFJAXCx1b/9htfRv5jkBYWnQWcXztZLb1dG1vlG8bgPljt+KH5qKZ1e+C/BHY1CqM8b9S/0Tc3xFw1fOpbY5rPLw86nCAxg==,iv:2o9LWvhqiL6XnWBHvDwEOJzOSkugEBTdb6uJcubfvjQ=,tag:m/STH74+Tvx0CoN1EYfnDg==,type:str]
    dex.authentik.clientSecret: ENC[AES256_GCM,data:MU4pftPI76eiu8suiO+fKogA61IccnB4COvCkhOyqgEN2mmD7exlqkSp26ZG2htLhI58qRb2/0Om8gwO5iISzVYxuZ8/dZppKWFNS64HwdOeGEb4p3sCjvNXhGPx3mecbTVcBzlcyBbWfKOkVt5VA/SZ268jyJedkA97kxmtEgsw6u7bYjqVKldVlhzr/8K4B84SMzspuFS5TFj917bsLGuqV1dVgK6lVTcYCvUL8J/RmaJodvBKG2bttzQmzP5YRzDLkWodBbbWqKkeWP3Ne+vP8VAQfeLaqJly6llmrkTHflISPnenW+O3OJtp2McaRriADkVw+JKbSmbvyrU4pJVvxTFrvQ+UBT9LV46z0XK7+DJxebnE,iv:30oeAyxS0YSMY6ntDhl2n96ZBMhWZsOy+4GVESmkihE=,tag:EcmSkiDcgCb1mh2uXf6HBw==,type:str]
controller:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
dex:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
redis:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
server:
  extensions:
    enabled: true
    extensionList:
      - name: rollout-extension
        env:
          - name: EXTENSION_URL
            value: https://github.com/argoproj-labs/rollout-extension/releases/download/v0.3.4/extension.tar
  replicas: 2
  allowAnyNamespace: true
  ingress:
    enabled: true
    ingressClassName: external
    annotations:
      external-dns.alpha.kubernetes.io/target: external.wakkalabs.com
    hostname: argo.wakkalabs.com
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
  containers:
    - args:
        - /usr/local/bin/argocd-server
        - --port=8080
        - -metrics-port=8083
notifications:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
repoServer:
  replicas: 2
  serviceAccount:
    create: true
    name: argocd-repo-server
  rbac:
    - apiGroups:
        - ""
      resources:
        - secrets
      verbs:
        - get
  env:
    - name: HELM_PLUGINS
      value: /custom-tools/helm-plugins/
    - name: HELM_SECRETS_CURL_PATH
      value: /custom-tools/curl
    - name: HELM_SECRETS_SOPS_PATH
      value: /custom-tools/sops
    - name: HELM_SECRETS_VALS_PATH
      value: /custom-tools/vals
    - name: HELM_SECRETS_KUBECTL_PATH
      value: /custom-tools/kubectl
    - name: HELM_SECRETS_BACKEND
      value: sops
    - name: HELM_SECRETS_VALUES_ALLOW_SYMLINKS
      value: "false"
    - name: HELM_SECRETS_VALUES_ALLOW_ABSOLUTE_PATH
      value: "true"
    - name: HELM_SECRETS_VALUES_ALLOW_PATH_TRAVERSAL
      value: "false"
    - name: HELM_SECRETS_WRAPPER_ENABLED
      value: "true"
    - name: HELM_SECRETS_DECRYPT_SECRETS_IN_TMP_DIR
      value: "true"
    - name: HELM_SECRETS_HELM_PATH
      value: /usr/local/bin/helm
    - name: SOPS_AGE_KEY_FILE
      value: /helm-secrets-private-keys/key.txt
  volumes:
    - name: custom-tools
      emptyDir: {}
    - name: helm-secrets-private-keys
      secret:
        secretName: ENC[AES256_GCM,data:X/vHCOEujW79K58QlPREa+3aovuzJZsIBxG8ZNgc2+VXLasqvBIDVMvwEeguzl+jOTzZI/Lu6jbF9xthvEVn2OrEMlG+s+0sZ8GdL6tLYj2Nw71RWmuv22LrgckT4Svdj5YXkzD/vfpUVvhw2XnwlPBtpNP4z0YG4ebYVxuqTGhNSgBkjvgrlF8k6tPBE/E=,iv:TlWkr18Pjw8b//iOgQ7i7qLhMTFk/wR4LRKvHJVb57E=,tag:ffLjbsppci48Lkp+sPOCfg==,type:str]
  volumeMounts:
    - mountPath: /custom-tools
      name: custom-tools
    - mountPath: /usr/local/sbin/helm
      subPath: helm
      name: custom-tools
    - mountPath: /usr/local/bin/kustomize
      name: custom-tools
      subPath: kustomize
    - mountPath: /usr/local/bin/ksops
      name: custom-tools
      subPath: ksops
    - mountPath: /helm-secrets-private-keys/
      name: helm-secrets-private-keys
  initContainers:
    - name: gitops-tools
      image: ajaykumar4/gitops-tools:1.0.1
      imagePullPolicy: Always
      command:
        - sh
        - -ec
      args:
        - |
          mkdir -p /custom-tools/
          cp -rf /gitops-tools/* /custom-tools
          chmod +x /custom-tools/*
      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools
sops:
  age:
    - recipient: age18ynkp4xzwas6la23fvs5zhxazvqf7p3qw4vv26a346e8340gegfqh9c87h
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBzL0RRZXZZNlRnNWZOSEE3
        QjVEMnFPNWlKb29SaGsrMW93KzJvMWMyb1MwCmhCaEJYMXVZMWl4dE5iSXFVQnhZ
        Y1BNNGJVaFRHQi9EVzN6MDV5ai9HN1kKLS0tIHIxSFZ2OTN4Rmo4dHJaeEZPUVc3
        RDhhNFh3VUxHUWNjNEdLbS93WUdEWXMKZgCPbmc45Y3LZyqg24w5ke1padlS4tah
        OR6egvBzMYBT6m5h4Jj9dDsdhduTYXI+8/xC74Bigv9+0047e36oPg==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-26T10:15:04Z"
  mac: ENC[AES256_GCM,data:QijXKBk4Vq0g9dYL0VTFz6JIH3Q0fRxClCk9YBVkqd8nVgQ37EsTxivmdWtZDdC9Vs/D/zwvpXw5kEiGB9VKcJJ0Ue2L0sX4+ha1ACSXDfxLtiTDnFT0mIepvKjSbh06MOuT1eJ0V8R4tMR6zt4bx94TQUaMmh0D4AUtITg8Bt0=,iv:mDsa5G6+DJvrS+dw1ToV2/NcIOq2WUrnZgmECC0HYnI=,tag:fbbZ4CCvL5wfhZA2Hps3xg==,type:str]
  encrypted_regex: ^(data|stringData|.*[Pp]assword|.*[Ss]ecret|.*[Tt]oken)$
  version: 3.10.2
