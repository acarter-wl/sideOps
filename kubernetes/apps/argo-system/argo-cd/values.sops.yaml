crds:
  install: true
global:
  domain: argo.wakkalabs.com
  serviceMonitor:
    namespace: argo-system
    additionalLabels:
      release: kube-prometheus-stack
configs:
  params:
    server.insecure: true
  cm:
    dex.config: |
      connectors:
        - type: oidc
          id: authentik
          name: authentik
          config:
            issuer: https://auth.wakkalabs.com/application/o/argocd/
            clientID: GHFrNg3pZTxyoxvzuut0q0Kr2HSkBBqX0rqINETT
            clientSecret: $dex.authentik.clientSecret
            insecureEnableGroups: true
            scopes:
              - openid
              - profile
              - email
              - groups
            getUserInfo: true
    exec.enabled: true
    accounts.readonly: apikey
    statusbadge.enabled: true
    kustomize.buildOptions: --enable-alpha-plugins --enable-exec
    helm.valuesFileSchemes: |
      secrets+gpg-import, secrets+gpg-import-kubernetes, secrets+age-import, secrets+age-import-kubernetes, secrets, secrets+literal, https
    resource.exclusions:
      - apiGroups:
          - cilium.io
        kinds:
          - CiliumIdentity
        clusters:
          - '*'
  rbac:
    scopes: '[groups]'
    groupClaim: groups
    policy.default: role:readonly
    policy.rules: |
      p, role:admin, *, *, *, allow
      g, ArgoCD Admins, role:admin
  secret:
    argocdServerAdminPassword: ENC[AES256_GCM,data:jSpIANtRdjE4UTkBWMu67fjFjZQhtrK60et0KR/O25GMWSDTdlMQKLLQvzyRYQ/g5B8=,iv:Uk2MxtfLkSZecnq7Kb5vvxAo8JOok32qzcA7OiLYQvk=,tag:bgUkd4lx/tpQRXGNJianSA==,type:str]
    argocdServerAdminPasswordM: ENC[AES256_GCM,data:upBfKIkHU4BEht9g6GZaGlN3gBD+/SdPuDIWS5EsPGTTfNP0MkP54+0ecqy0oku/flh6XkdnKRxYeefMZ8IY7YJxsAtwt+GayiZlKxVX+P4OBVPUm3LN3YbpDDggqyJftFu6I+UxWfskIledOatHaGF1IfAiq9MLQnWwkAHCSm8=,iv:4r0i64CI0gVuiLO8xxsJ1XIlwDGY3TOE8PAri7UVfic=,tag:NiC3nlgoAfUWMlA6x/P+Hw==,type:str]
    githubSecret: ENC[AES256_GCM,data:tNrk6COgI0T4VeJz6pBMC0P9soTIywrY/xvfZx3T4kU=,iv:YW1mHQE3YRXzEApSLSwo+4882c2pIF/O0X7oj1Z8RrQ=,tag:IuC0EJSMGrLdCm99ehpt3g==,type:str]
    dex.authentik.clientSecret: ENC[AES256_GCM,data:PIwg3lN5sjFvjJmxgCCzwlefoVsgmNU8+9RplRJwNOBV3BeLF4+EsKhanJ9fIqQF+LUIALkfEk07dSCslP1VDOITWhy0M27qIcSnz08VIBK59u7EX6uI9eSBSNssWubMUW3ljH+Hg4/wGKiZSYAUe1A3dTByOBs451m/q/EhPBE=,iv:2PJf+jIyWiYSLGMos3NBxX+22xt6haDRjaFUmSe4C6I=,tag:n2ivk+xL2MbFQxEqJc50UQ==,type:str]
controller:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
dex:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
redis:
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
server:
  extensions:
    enabled: true
    extensionList:
      - name: rollout-extension
        env:
          - name: EXTENSION_URL
            value: https://github.com/argoproj-labs/rollout-extension/releases/download/v0.3.4/extension.tar
  replicas: 2
  allowAnyNamespace: true
  ingress:
    enabled: true
    ingressClassName: external
    annotations:
      external-dns.alpha.kubernetes.io/target: external.wakkalabs.com
    hostname: argo.wakkalabs.com
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
  containers:
    - args:
        - /usr/local/bin/argocd-server
        - --port=8080
        - -metrics-port=8083
notifications:
  replicas: 2
  metrics:
    enabled: true
    serviceMonitor:
      enabled: true
      namespace: argo-system
      additionalLabels:
        release: kube-prometheus-stack
repoServer:
  replicas: 2
  serviceAccount:
    create: true
    name: argocd-repo-server
  rbac:
    - apiGroups:
        - ""
      resources:
        - secrets
      verbs:
        - get
  env:
    - name: HELM_PLUGINS
      value: /custom-tools/helm-plugins/
    - name: HELM_SECRETS_CURL_PATH
      value: /custom-tools/curl
    - name: HELM_SECRETS_SOPS_PATH
      value: /custom-tools/sops
    - name: HELM_SECRETS_VALS_PATH
      value: /custom-tools/vals
    - name: HELM_SECRETS_KUBECTL_PATH
      value: /custom-tools/kubectl
    - name: HELM_SECRETS_BACKEND
      value: sops
    - name: HELM_SECRETS_VALUES_ALLOW_SYMLINKS
      value: "false"
    - name: HELM_SECRETS_VALUES_ALLOW_ABSOLUTE_PATH
      value: "true"
    - name: HELM_SECRETS_VALUES_ALLOW_PATH_TRAVERSAL
      value: "false"
    - name: HELM_SECRETS_WRAPPER_ENABLED
      value: "true"
    - name: HELM_SECRETS_DECRYPT_SECRETS_IN_TMP_DIR
      value: "true"
    - name: HELM_SECRETS_HELM_PATH
      value: /usr/local/bin/helm
    - name: SOPS_AGE_KEY_FILE
      value: /helm-secrets-private-keys/key.txt
  volumes:
    - name: custom-tools
      emptyDir: {}
    - name: helm-secrets-private-keys
      secret:
        secretName: ENC[AES256_GCM,data:XgJEuWOuCZBc9ObKc+xdB1ae2+GZ3LRNfenHViDNa0BOdade3js7B55NfVXKNw1ABxve/PAP3K5+dGhZd6XhRYuPx29XAzmKvnuqAgg7qrbW9Go69QZJ/ybsboFP4q0fYH592lqnRvFAvFF0KHY8eIVs5EgsrpU2hBZEeziW9ydzhSosya216RmlHMLm0eYwGlEGuEC3w9tCd67Fgzq2diOgp+4Gn154CfVneMwtKzikjokGekB91Czg62O92t9U066ASFu4Wo9NuRBRczZKX0tXeNcXcAc8Lnc8qXKzqbRsN+gi0XKTL37OMJOq4HTH7QiTF8i3/YOvZ7bJr1BLbkGD8SGerQspFIPBArGIT2QP4Z3Qp5Y/JGjOEnnlvpZo+4QA2W7E9kE7pFNbocAKl3iEMutOo1Br1zpD/sWZJVVGacNlHd0r0agCXvfytwWwQHVz6lKUiye2iX7ESKabQ0IrUxfQBknNj66+GxmBFldimFagRLFYqHkugt3w8hKopfmnW1UWoRzIV5LAtSeqKo7kPIRaj53EflMkgz/bmGyqS/SaYGrergdmeA2eAfMNFjfg79CcUbtII6764gU2y8Igk5uUa0oXglwhWwHZHmpoaruNWIn4cHUe6J+4ZxMXdjwTIbLHNTDvYysixpsCckzYlwwpRzqhufoR,iv:0OqptKGCQbt0ksC4s8fsLm9cAU1qZptFJX+v/qWjwtg=,tag:BWmmjDe9UGwRZY4k2INjOA==,type:str]
  volumeMounts:
    - mountPath: /custom-tools
      name: custom-tools
    - mountPath: /usr/local/sbin/helm
      subPath: helm
      name: custom-tools
    - mountPath: /usr/local/bin/kustomize
      name: custom-tools
      subPath: kustomize
    - mountPath: /usr/local/bin/ksops
      name: custom-tools
      subPath: ksops
    - mountPath: /helm-secrets-private-keys/
      name: helm-secrets-private-keys
  initContainers:
    - name: gitops-tools
      image: ajaykumar4/gitops-tools:1.0.1
      imagePullPolicy: Always
      command:
        - sh
        - -ec
      args:
        - |
          mkdir -p /custom-tools/
          cp -rf /gitops-tools/* /custom-tools
          chmod +x /custom-tools/*
      volumeMounts:
        - mountPath: /custom-tools
          name: custom-tools
sops:
  age:
    - recipient: age18ynkp4xzwas6la23fvs5zhxazvqf7p3qw4vv26a346e8340gegfqh9c87h
      enc: |
        -----BEGIN AGE ENCRYPTED FILE-----
        YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSBJOE13dm83TXZ1WldlMlla
        anNsQWNsTzlRTjBPcDZRUDZYOXBKSGJqUkE0CnRMUUdCWHdwYlZMSWJFVEp6Z2dj
        Y05Fbndyd2lvWE5WbkpmZnBYWGJKL0EKLS0tIFlFUWgrNWFvY2d2WGVUSE5JZmZB
        QkpGZ2tob0szVHVqT1Fkb21oOHVVZ1EKPysGtncGcEmkiVSzLJXyleVG38ZWwHZm
        v6TYvjcXWu8/LXNxiqz/21lag0cEE1QnWBhI+NfxQXleELltMuZjGQ==
        -----END AGE ENCRYPTED FILE-----
  lastmodified: "2025-04-26T23:49:22Z"
  mac: ENC[AES256_GCM,data:T7cdWeO9zSb1lsF/iLJ7miotLTXChW5EnESxRQ9JotyM4eekzvOUlXWAmeb8svCIAOOntmcx3monk/WzOqVIDjnlFuYak+HxxwrTNbH00Itz6NDMEoggsIhbbMjzLVRI9eGBeHA3aqMqZHvFinI0LEb6gnQEdiRNMZRo/L1mJmI=,iv:XY0sqTx5HH4tTlu1/stM3oFZToYiBtBrrzFxXLjw5cQ=,tag:sT6I44Cs3eWXWqwUdkLibA==,type:str]
  encrypted_regex: ^(data|stringData|.*[Pp]assword|.*[Ss]ecret|.*[Tt]oken)$
  version: 3.10.2
