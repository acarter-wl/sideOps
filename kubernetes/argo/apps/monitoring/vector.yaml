apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: vector
  namespace: argo-system
spec:
  destination:
    namespace: monitoring
    server: https://kubernetes.default.svc
  project: default
  source:
    chart: vector
    repoURL: https://helm.vector.dev
    targetRevision: 0.42.1
    helm:
      values: |
        role: Agent
        service:
          enabled: false
        customConfig:
          data_dir: "/vector-data-dir"
          sources:
            kubernetes_logs:
              type: kubernetes_logs
          sinks:
            clickhouse:
              type: clickhouse
              inputs: ["kubernetes_logs"]
              endpoint: "http://clickhouse.monitoring.svc.cluster.local:8123"
              database: "logs"
              table: "kubernetes_logs"
              auth:
                user: "vector"
                password: "vectorpass"
              compression: "gzip"
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
