apiVersion: v1
kind: Pod
metadata:
  name: storage-benchmark
  namespace: default
spec:
  containers:
    - name: benchmark
      image: nixery.dev/shell/fio
      command:
        - "/bin/sh"
        - "-c"
        - "cd /data && fio --name=benchmark --ioengine=libaio --rw=randrw --bs=4k --direct=1 --size=1G --numjobs=4 --runtime=60 --time_based --group_reporting"
      volumeMounts:
        - name: benchmark-volume
          mountPath: /data
  volumes:
    - name: benchmark-volume
      persistentVolumeClaim:
        claimName: benchmark-pvc
  restartPolicy: Never
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: benchmark-pvc
  namespace: default
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
  storageClassName: ceph-block
